COMMENT UTILISER ?

1. Créez un nouveau favori dans votre navigateur, par exemple Chrome.
2. Ajoutez le nom du favori, par exemple "Sources de ChatGPT".
3. Dans le champs URL ajoutez le code ci-dessous.
4. Soumettez votre prompt dans ChatGPT et une fois que la réponses est générée, cliquer sur le favori créé.

Code Javascript à utiliser :

javascript:(async()=>{try{const cid=(location.pathname.match(/\/c\/([^/]+)/)||[])[1];if(!cid){alert('Open a ChatGPT conversation first.');return;}const sess=await fetch('/api/auth/session').then(r=>r.json());const res=await fetch('/backend-api/conversation/'+cid,{headers:{'Authorization':'Bearer '+sess.accessToken,'Content-Type':'application/json'}});const data=await res.json();let userPrompt='';(function findPrompt(o){if(userPrompt||!o||typeof o!=='object')return;const c=o.content;if(c&&typeof c==='object'&&Array.isArray(c.parts)&&c.parts.length&&typeof c.parts[0]==='string'){userPrompt=(c.parts[0]||'').toString().trim();if(userPrompt)return;}for(const k in o){findPrompt(o[k])}})(data);if(!userPrompt)userPrompt='ChatGPT Insider';const queries=new Set();const addQuery=v=>{if(typeof v==='string'){v=v.trim();if(v)queries.add(v)}};const extractQueries=obj=>{if(!obj||typeof obj!=='object')return;if(Array.isArray(obj.search_queries)){obj.search_queries.forEach(sq=>{if(sq&&typeof sq==='object'&&sq.q)addQuery(sq.q)})}if(obj.metadata&&typeof obj.metadata==='object'){if(Array.isArray(obj.metadata.search_queries)){obj.metadata.search_queries.forEach(sq=>{if(sq&&typeof sq==='object'&&sq.q)addQuery(sq.q)})}const smq=obj.metadata.search_model_queries;if(Array.isArray(smq)){smq.forEach(addQuery)}else if(smq&&typeof smq==='object'){if(Array.isArray(smq.queries))smq.queries.forEach(addQuery);if(Array.isArray(smq.searchQueries))smq.searchQueries.forEach(addQuery)}}for(const k in obj){if(k==='search_queries'||k==='metadata')continue;extractQueries(obj[k])}};extractQueries(data);const uniqueQueries=[...queries];const sourcesMap=new Map();const addSource=src=>{if(!src||typeof src!=='object')return;const title=(src.title||'').toString().trim();const url=(src.url||'').toString().trim();const attribution=(src.attribution||'').toString().trim();if(!title&&!url)return;const key=(url||'')+'|'+(title||'');if(!sourcesMap.has(key))sourcesMap.set(key,{title,url,attribution})};const extractSources=obj=>{if(!obj||typeof obj!=='object')return;if(Array.isArray(obj.sources)){obj.sources.forEach(addSource)}for(const k in obj){extractSources(obj[k])}};extractSources(data);const sourcesRows=[...sourcesMap.values()];const norm=u=>!u?%27%27:String(u).replace(%27?utm_source=chatgpt.com%27,%27%27).replace(%27&utm_source=chatgpt.com%27,%27%27);const sourceUrlSet=new Set(sourcesRows.map(r=>norm(r.url)));const srgFirstRows=[];const moreSet=new Set();let srgCount=0;const walkSRG=obj=>{if(!obj||typeof obj!==%27object%27)return;if(obj.metadata&&Array.isArray(obj.metadata.search_result_groups)){srgCount++;const groups=obj.metadata.search_result_groups;if(srgCount===1){groups.forEach(g=>{if(g&&Array.isArray(g.entries)){g.entries.forEach(en=>{if(en&&typeof en===%27object%27){const title=(en.title||%27%27).toString().trim();const url=(en.url||%27%27).toString().trim();const attribution=(en.attribution||%27%27).toString().trim();const snippet=(en.snippet||%27%27).toString().trim();const ref_type=(en.ref_id&&en.ref_id.ref_type)||%27%27;if(title||url||attribution||snippet||ref_type)srgFirstRows.push({title,url,attribution,snippet,ref_type})}})}})}else if(srgCount===2){groups.forEach(g=>{if(g&&Array.isArray(g.entries)){g.entries.forEach(en=>{const u=(en&&en.url)||%27%27;if(u)moreSet.add(norm(String(u)))})}})} }for(const k in obj){if(srgCount>=2)break;walkSRG(obj[k])}};walkSRG(data);const srgRows=srgFirstRows.map(r=>{const u=norm(r.url);const tags=[];if(sourceUrlSet.has(u))tags.push(%27citation%27);if(moreSet.has(u))tags.push(%27more%27);return Object.assign({citation_status:tags.join(%27, %27)},r)});const citationOnlyRows=srgRows.filter(r=>(r.citation_status||%27%27).split(%27,%27).map(s=>s.trim()).includes(%27citation%27));if(uniqueQueries.length===0&&citationOnlyRows.length===0&&srgRows.length===0){alert(%27No fan-out queries or search_result_groups found.%27);return;}const win=window.open(%27%27,%27_blank%27);const doc=win.document;doc.open();doc.close();doc.title=%27ChatGPT Insider : %27+userPrompt;const style=doc.createElement(%27style%27);style.textContent=%27:root{--pri:#4299e1;--bg:#f8fafc;--card:#fff;--ink:#0f172a;--mut:#64748b;--border:#e2e8f0;--green:#16a34a;--indigo:#4f46e5;--blue:#2563eb;--amber:#d97706;--purple:#7c3aed;--gray:#475569}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;max-width:1400px;margin:40px auto;padding:24px;background:var(--bg);color:var(--ink);line-height:1.6}h1{margin:0 0 6px;border-bottom:3px solid var(--pri);padding-bottom:10px}.mut{color:var(--mut)}.wrap{display:flex;flex-direction:column;gap:22px}.section{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 2px 8px rgba(0,0,0,.08);border:1px solid #edf2f7}.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}.clipboard-btn{background:linear-gradient(100deg,#40ddff -6.08%,#7612fa 25.08%,#fa12e3);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:14px;transition:.2s}.clipboard-btn:hover{filter:brightness(.95);transform:translateY(-1px)}.toast{position:fixed;top:20px;right:20px;background:#48bb78;color:#fff;padding:12px 16px;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,.18);opacity:0;transform:translateX(100%);transition:all .3s;z-index:1000}.toast.show{opacity:1;transform:translateX(0)}.list{display:grid;grid-template-columns:1fr;gap:10px}.query{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;border:1px solid var(--border);background:#f7fafc;border-left:4px solid var(--pri);padding:10px;border-radius:8px}table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--border);border-radius:12px;overflow:hidden}.tbl{table-layout:fixed}.tbl,.tbl *{font-size:12px !important}th,td{padding:10px 12px;border-bottom:1px solid #edf2f7;vertical-align:top}th{text-align:left;font-weight:600;background:#f1f5f9}tr:last-child td{border-bottom:none}td a{color:#1a73e8;text-decoration:none;word-break:break-all}.grid{display:grid;grid-template-columns:1fr;gap:22px}.wide{grid-column:1/-1}.title a{word-break:break-word;white-space:normal}.snippet{color:var(--mut);word-break:break-word;white-space:normal}.tbl col.col-cit{width:110px}.tbl col.col-idx{width:48px}.tbl col.col-title{width:28%}.tbl col.col-url{width:22%}.tbl col.col-attr{width:12%}.tbl col.col-type{width:100px}.tbl col.col-snip{width:30%}.metrics-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin-top:10px;margin-bottom:20px}@media(max-width:1100px){.metrics-grid{grid-template-columns:repeat(3,1fr)}}@media(max-width:600px){.metrics-grid{grid-template-columns:repeat(2,1fr)}}.kpi{display:flex;flex-direction:column;gap:6px;border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer;transition:.2s;background:#ffffff}.kpi:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.08)}.kpi.active{outline:2px solid var(--pri)}.kpi .label{display:flex;align-items:center;gap:8px;color:var(--mut)}.kpi .value{font-size:28px;font-weight:700;letter-spacing:.2px}.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:600;line-height:1.6;border:1px solid transparent}.b-search{background:rgba(37,99,235,.12);color:var(--blue);border-color:rgba(37,99,235,.25)}.b-news{background:rgba(217,119,6,.12);color:var(--amber);border-color:rgba(217,119,6,.25)}.b-academia{background:rgba(124,58,237,.12);color:var(--purple);border-color:rgba(124,58,237,.25)}.b-other{background:rgba(71,85,105,.12);color:var(--gray);border-color:rgba(71,85,105,.25)}.b-citation{background:rgba(22,163,74,.12);color:var(--green);border-color:rgba(22,163,74,.25)}.b-more{background:rgba(79,70,229,.12);color:var(--indigo);border-color:rgba(79,70,229,.25)}.b-dash{background:#f1f5f9;color:#64748b;border-color:#e2e8f0}.row-citation td{background:#ecfdf5}/* light green */.chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;font-size:12px}.chip .x{font-weight:900;cursor:pointer}.more-btn{border:1px solid #cbd5e1;background:#f8fafc;border-radius:8px;padding:4px 8px;cursor:pointer}';doc.head.appendChild(style);const toast=doc.createElement('div');toast.className='toast';toast.id='toast';toast.textContent='Copied to clipboard!';doc.body.appendChild(toast);const showToast=()=>{toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),2500)};const root=doc.createElement('div');root.className='wrap';const h1=doc.createElement('h1');h1.textContent='ChatGPT Insider : '+userPrompt;root.appendChild(h1);const subtitle=doc.createElement('div');subtitle.className='mut';subtitle.textContent='Fan-Out, used external sources and citations in SearchGPT';root.appendChild(subtitle);const secQ=doc.createElement('div');secQ.className='section';const headQ=doc.createElement('div');headQ.className='header';const hQ=doc.createElement('h2');hQ.textContent='Fan-Out ('+uniqueQueries.length+')';const btnQ=doc.createElement('button');btnQ.className='clipboard-btn';btnQ.textContent='Copy items';btnQ.addEventListener('click',()=>{const t=uniqueQueries.join('\n');(navigator.clipboard?navigator.clipboard.writeText(t):Promise.reject()).then(showToast).catch(()=>{const ta=doc.createElement('textarea');ta.value=t;doc.body.appendChild(ta);ta.select();doc.execCommand('copy');ta.remove();showToast()})});headQ.appendChild(hQ);headQ.appendChild(btnQ);secQ.appendChild(headQ);const list=doc.createElement('div');list.className='list';uniqueQueries.forEach(q=>{const d=doc.createElement('div');d.className='query';d.textContent=q;list.appendChild(d)});secQ.appendChild(list);root.appendChild(secQ);const makeBadge=(type,text)=>{const span=doc.createElement('span');span.className='badge '+type;span.textContent=text;return span};const buildTable=(caption,rows,wide,attachRefs)=>{const sec=doc.createElement('div');sec.className='section';if(wide)sec.classList.add('wide');const head=doc.createElement('div');head.className='header';const h=doc.createElement('h2');h.textContent=caption;const btn=doc.createElement('button');btn.className='clipboard-btn';btn.textContent='Copy rows';head.appendChild(h);head.appendChild(btn);sec.appendChild(head);const tbl=doc.createElement('table');tbl.className='tbl';const colgroup=doc.createElement('colgroup');['col-cit','col-idx','col-title','col-url','col-attr','col-type','col-snip'].forEach(cn=>{const c=doc.createElement('col');c.className=cn;colgroup.appendChild(c)});tbl.appendChild(colgroup);const thead=doc.createElement('thead');const thr=doc.createElement('tr');['Citation Status','#','Title','URL','Attribution','ref_type','Snippet'].forEach(t=>{const th=doc.createElement('th');th.textContent=t;thr.appendChild(th)});thead.appendChild(thr);tbl.appendChild(thead);const tbody=doc.createElement('tbody');tbl.appendChild(tbody);sec.appendChild(tbl);const doCopy=(getRows)=>{const cols=['citation_status','title','url','attribution','ref_type','snippet'];const rs=getRows();const lines=rs.map(r=>cols.map(c=>r[c]||'').join('\t')).join('\n');(navigator.clipboard?navigator.clipboard.writeText(lines):Promise.reject()).then(showToast).catch(()=>{const ta=doc.createElement('textarea');ta.value=lines;doc.body.appendChild(ta);ta.select();doc.execCommand('copy');ta.remove();showToast()})};let getRows=()=>rows;btn.addEventListener('click',()=>doCopy(getRows));if(attachRefs){attachRefs.tbody=tbody;attachRefs.rowsSource=rows;attachRefs.sec=sec;attachRefs.head=head;attachRefs.setGetRows=(fn)=>{getRows=fn};}return sec};const grid=doc.createElement('div');grid.className='grid';const citationTableRefs={};grid.appendChild(buildTable('Citations — '+citationOnlyRows.length,citationOnlyRows,true,citationTableRefs));const plusTableRefs={};grid.appendChild(buildTable('All External Sources — '+srgRows.length,srgRows,true,plusTableRefs));root.appendChild(grid);doc.body.appendChild(root);const currentFilter={type:'all'};const activeChip=doc.createElement('div');activeChip.className='chip';activeChip.style.display='none';activeChip.innerHTML='Filter: <span class=\"lbl\"></span> <span class=\"x\">×</span>';plusTableRefs.head.parentNode.insertBefore(activeChip,plusTableRefs.head.nextSibling);activeChip.querySelector('.x').addEventListener('click',()=>{currentFilter.type='all';activeChip.style.display='none';Array.from(cards.children).forEach(c=>c.classList.remove('active'));renderTables()});const totals={total:srgRows.length,search:srgRows.filter(r=>(r.ref_type||'')==='search').length,searchSnip:srgRows.filter(r=>(r.ref_type||'')==='search'&&(r.snippet||'').length>0).length,news:srgRows.filter(r=>(r.ref_type||'')==='news').length,academia:srgRows.filter(r=>(r.ref_type||'')==='academia').length,other:srgRows.filter(r=>!['search','news','academia'].includes((r.ref_type||''))).length};const cards=document.createElement('div');cards.className='metrics-grid';plusTableRefs.head.parentNode.insertBefore(cards,activeChip.nextSibling);const kpis=[{key:'all',label:'Total external sources',value:totals.total,badgeClass:'b-other'},{key:'search',label:'Search',value:totals.search,badgeClass:'b-search'},{key:'search_snip',label:'Search w/snippets',value:totals.searchSnip,badgeClass:'b-search'},{key:'news',label:'News',value:totals.news,badgeClass:'b-news'},{key:'academia',label:'Academia',value:totals.academia,badgeClass:'b-academia'},{key:'other',label:'Other',value:totals.other,badgeClass:'b-other'}];kpis.forEach(k=>{const card=doc.createElement('div');card.className='kpi';const lab=doc.createElement('div');lab.className='label';lab.appendChild(makeBadge(k.badgeClass,k.label.split(' ')[0]));const rest=k.label.indexOf(' ')>0?k.label.slice(k.label.indexOf(' ')+1):'';if(rest){const span=doc.createElement('span');span.textContent=rest;lab.appendChild(span);}const val=doc.createElement('div');val.className='value';val.textContent=String(k.value);card.appendChild(lab);card.appendChild(val);card.addEventListener('click',()=>{currentFilter.type=k.key;Array.from(cards.children).forEach(c=>c.classList.remove('active'));card.classList.add('active');activeChip.style.display=k.key==='all'?'none':'inline-flex';activeChip.querySelector('.lbl').textContent=k.label;renderTables()});cards.appendChild(card)});const makeBadgeType=rt=>{const t=(rt||'').toLowerCase();if(t==='search')return makeBadge('b-search','search');if(t==='news')return makeBadge('b-news','news');if(t==='academia')return makeBadge('b-academia','academia');return makeBadge('b-other','other')};const makeCitBadges=cs=>{const wrap=doc.createElement('div');const parts=(cs||'').split(',').map(s=>s.trim()).filter(Boolean);if(parts.length===0){wrap.appendChild(makeBadge('b-dash','-'));return wrap;}parts.forEach(p=>{if(p==='citation')wrap.appendChild(makeBadge('b-citation','citation'));else if(p==='more')wrap.appendChild(makeBadge('b-more','more'))});return wrap};const applyFilter=rows=>{const t=currentFilter.type;if(t==='all')return rows; if(t==='search')return rows.filter(r=>(r.ref_type||'')==='search'); if(t==='search_snip')return rows.filter(r=>(r.ref_type||'')==='search'&&(r.snippet||'').length>0); if(t==='news')return rows.filter(r=>(r.ref_type||'')==='news'); if(t==='academia')return rows.filter(r=>(r.ref_type||'')==='academia'); if(t==='other')return rows.filter(r=>!['search','news','academia'].includes((r.ref_type||''))); return rows};const fillTbody=(tbody,rows)=>{tbody.innerHTML='';rows.forEach((r,i)=>{const tr=doc.createElement('tr');const hasCitation=(r.citation_status||'').split(',').map(s=>s.trim()).includes('citation');if(hasCitation)tr.classList.add('row-citation');const tdCit=doc.createElement('td');tdCit.appendChild(makeCitBadges(r.citation_status));tr.appendChild(tdCit);const tdIdx=doc.createElement('td');tdIdx.textContent=String(i+1);tr.appendChild(tdIdx);const tdTitle=doc.createElement('td');tdTitle.className='title';if(r.title){const a=doc.createElement('a');a.textContent=r.title;a.href=r.url||'#';a.target='_blank';tdTitle.appendChild(a)}tr.appendChild(tdTitle);const tdUrl=doc.createElement('td');if(r.url){const a2=doc.createElement('a');a2.textContent=r.url;a2.href=r.url;a2.target='_blank';tdUrl.appendChild(a2)}tr.appendChild(tdUrl);const tdAttr=doc.createElement('td');tdAttr.textContent=r.attribution||'';tr.appendChild(tdAttr);const tdRef=doc.createElement('td');tdRef.appendChild(makeBadgeType(r.ref_type));tr.appendChild(tdRef);const tdSnip=doc.createElement('td');tdSnip.className='snippet';const snip=r.snippet||'';if(snip.length>600){const span=doc.createElement('span');span.textContent=snip.slice(0,400)+'… ';const more=doc.createElement('button');more.className='more-btn';more.textContent='More';more.addEventListener('click',()=>{span.textContent=snip;more.remove()});tdSnip.appendChild(span);tdSnip.appendChild(more);}else{tdSnip.textContent=snip;}tr.appendChild(tdSnip);tbody.appendChild(tr)})};function renderTables(){const filteredPlus=applyFilter(plusTableRefs.rowsSource||[]);fillTbody(plusTableRefs.tbody,filteredPlus);plusTableRefs.setGetRows&&plusTableRefs.setGetRows(()=>filteredPlus);const filteredCitations=applyFilter(citationTableRefs.rowsSource||[]);fillTbody(citationTableRefs.tbody,filteredCitations);citationTableRefs.setGetRows&&citationTableRefs.setGetRows(()=>filteredCitations)}renderTables();const footer=doc.createElement('div');footer.style.cssText='margin-top:18px;font-size:12px;color:#64748b;text-align:center';footer.innerHTML='Made with ❤%EF%B8%8F by <a href="https://www.linkedin.com/in/alexisrylko/" target="_blank" rel="noopener">Alexis Rylko</a> - <a href="https://newsletter.alekseo.com/" target="_blank" rel="noopener">💌 newsletter.alekseo.com</a>.';doc.body.appendChild(footer)}catch(e){alert('Could not fetch conversation data. Make sure you are logged in to ChatGPT.');console.error(e)}})();
